<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Saving Portal State - jQuery EasyUI</title>
    <link rel="stylesheet" type="text/css" href="css/easyui.css">
	<link rel="stylesheet" type="text/css" href="css/icon.css">
    
    <script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="echarts/echarts.js"></script>
    <script type="text/javascript" src="js/portal.js"></script>
    <style type="text/css">
        .demo-rtl .portal-column-left{
            padding-left: 10px;
            padding-right: 10px;
        }
        .demo-rtl .portal-column-right{
            padding-left:10px;
            padding-right: 10px;
        }
    </style>
</head>
<body id="portal_1_body" style="margin:0;">
    <div id="portal_1_div" style="width:100%">
        <div id="portal_1_left_div" style="width:50% "></div>
        <div id="portal_1_right_div" style="width:50% "></div>
    </div>
    <script type="text/javascript" src="js/portal.js"></script>
    <script type="text/javascript">
        var panels = [
            {id:'p1',href:'portal_p1.html'},
            {id:'p2',href:'portal_p2.html'},
            {id:'p3',href:'portal_p3.html'},
            {id:'p4',href:'portal_p4.html'},
            {id:'p5',href:'portal_p5.html'},
            {id:'p6',href:'portal_p6.html'}
        ];
        function getCookie(name){
            var cookies = document.cookie.split(';');
            if (!cookies.length) return '';
            for(var i=0; i<cookies.length; i++){
                var pair = cookies[i].split('=');
                if ($.trim(pair[0]) == name){
                    return $.trim(pair[1]);
                }
            }
            return '';
        }
        function getPanelOptions(id){
            for(var i=0; i<panels.length; i++){
                if (panels[i].id == id){
                    return panels[i];
                }
            }
            return undefined;
        }
        function getPortalState(){
            var aa = [];
            for(var columnIndex=0; columnIndex<3; columnIndex++){
                var cc = [];
                var panels = $('#portal_1_div').portal('getPanels', columnIndex);
                for(var i=0; i<panels.length; i++){
                    cc.push(panels[i].attr('id'));
                }
                aa.push(cc.join(','));
            }
            return aa.join(':');
        }
        //按当前的portal顺序加载portal
        function addPanels(portalState){
        	//分隔每列的portal
            var columns = portalState.split(':');
            for(var columnIndex=0; columnIndex<columns.length; columnIndex++){
            	//分隔每列每一行的portal
                var cc = columns[columnIndex].split(',');
                for(var j=0; j<cc.length; j++){
                    var options = getPanelOptions(cc[j]);
                    if (options){
                        var p = $('<div/>').attr('id',options.id).appendTo('body');
                        p.panel(options);
                        $('#portal_1_div').portal('add',{
                            panel:p,
                            columnIndex:columnIndex
                        });
                    }
                }
            }
            
        }
        
        $(function(){
        	//设置portaldiv充满iframe
        	$('#portal_1_div').width($('#portal_1_body').width()-20);
        	/*$('#portal_1_left_div').width($('#portal_1_div').width()/2);
        	$('#portal_1_right_div').width($('#portal_1_div').width()/2);*/
            $('#portal_1_div').portal({
                onStateChange:function(){
                    var state = getPortalState();
                    alert(state);
                    var date = new Date();
                    date.setTime(date.getTime() + 24*3600*1000);
                    document.cookie = 'portal-1-state='+state+';expires='+date.toGMTString();
                }
            });
            var state = getCookie('portal-1-state');
            if (!state){
                state = 'p1,p2,p3:p4,p5,p6';    // the default portal state
            }
            addPanels(state);
            $('#portal_1_div').portal('resize');
        });
    </script>
</body>
</html>