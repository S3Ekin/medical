<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>pie_chart</title>
	<style>
		img{width:70%;}
	</style>
	<script type="text/javascript" src="../../resources/jQuery/jquery.min.js"></script>
	<script type="text/javascript" src="../../resources/echarts/echarts.js"></script>
</head>
<body>
	<div id="p6_div_chart" style="width:100%;height: 500px"></div>
	<script type="text/javascript">
	radaroption = {
		animation:false,
        title: {
            text: '科室督查结果',
			left:'10%'
        },
        grid:{left:'15%'},
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            top:'bottom',
            //数据
            data:['1月','2月','3月']
        },
        //工具箱
        toolbox: {
            show: true,
            feature: {
                dataZoom: {
                    yAxisIndex: false
                },
                dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        //横坐标
        xAxis:  {
            type: 'category',
            boundaryGap: true,
            name:"科室",
            nameTextStyle:{
                color:"green",
				fontWeight:"bold",
				fontSize:18
			},
            data:['C T室','放 射 科','B 超 室','输 血 科']
//			//坐标轴类型，value数据，category类型，time时间，
//			type: 'category',
//			//起点和重点数据是否定格，是否留白
//			boundaryGap: true,
//			//数据
//			data: ['周一','周二','周三','周四','周五','周六','周日','周一','周二','周三','周四','周五','周六','周日']
        },
        //纵坐标
        yAxis: {
            name:"检查次数",
            nameTextStyle:{
                color:"green",
                fontWeight:"bold",
                fontSize:18
            },
            type: 'value',
            axisLabel: {
                formatter: '{value}次'
            }


//			type: 'value',
//			//纵坐标显示标签
//			axisLabel: {
//				formatter: '{value} °C'
//			}
        },
        series:[
            //准备添加的数据
            {
                name:'1月',
                //折线图
                type:'bar',
                //数据
                data:[1195,1426,1972,115]
            },
            {
                name:'2月',
                type:'bar',
                //数据
                data:[1071,1137,1416,95]
            },
            {
                name:'3月',
                type:'bar',
                data:[1362,1802,2105,160]
            }
        ]
    };
	function sumitImageFile(base64Codes){
		var form=document.forms[0];
		var formData = new FormData(form);   //这里连带form里的其他参数也一起提交了,如果不需要提交其他参数可以直接FormData无参数的构造函数
		//convertBase64UrlToBlob函数是将base64编码转换为Blob
		formData.append("imageName",convertBase64UrlToBlob(base64Codes));  //append函数的第一个参数是后台获取数据的参数名,和html标签的input的name属性功能相同
		//ajax 提交form
		$.ajax({
			url : form.action,
			type : "POST",
			data : formData,
			dataType:"text",
			processData : false,         // 告诉jQuery不要去处理发送的数据
			contentType : false,        // 告诉jQuery不要去设置Content-Type请求头

			success:function(data){
				window.location.href="${ctx}"+data;
			},
			xhr:function(){            //在jquery函数中直接使用ajax的XMLHttpRequest对象
				var xhr = new XMLHttpRequest();

				xhr.upload.addEventListener("progress", function(evt){
					if (evt.lengthComputable) {
						var percentComplete = Math.round(evt.loaded * 100 / evt.total);
						console.log("正在提交."+percentComplete.toString() + '%');        //在控制台打印上传进度
					}
				}, false);

				return xhr;
			}

		});
	}

	/**
	 * 将以base64的图片url数据转换为Blob
	 * @param urlData
	 *            用url方式表示的base64图片数据
	 */

	function convertBase64UrlToBlob(urlData){

		var bytes=window.atob(urlData.split(',')[1]);        //去掉url的头，并转换为byte

		//处理异常,将ascii码小于0的转换为大于0
		var ab = new ArrayBuffer(bytes.length);
		var ia = new Uint8Array(ab);
		for (var i = 0; i < bytes.length; i++) {
			ia[i] = bytes.charCodeAt(i);
		}

		return new Blob( [ab] , {type : 'image/png'});
	}




	var myChart = echarts.init($('#p6_div_chart').get(0));
		myChart.setOption(radaroption);
		window.onresize = myChart.resize;//窗口自适应
		/*echat转图片*/

	//var imgCanvas=document.getElementsByTagName('canvas')[0];
		//setTimeout(function () {
			//var data =encodeURIComponent(myChart.getDataURL("png"));
			var data =myChart.getDataURL("png");
			//console.log(data,"data");

			/*var imgCanvas=document.getElementsByTagName('canvas')[0];
			console.log(imgCanvas);
			var mgContext=imgCanvas.getContext('2d');
			var imgAsDataURL=imgCanvas.toDataURL("image/png");
			console.log(imgAsDataURL);*/
			var img=document.createElement("img")
			//img.src=imgAsDataURL;
			img.src=data;
			document.body.appendChild(img);
	//},3000)
	</script>
</body>
</html>