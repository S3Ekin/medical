<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>质量控制清单</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="../../resources/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/lib/awe/awesome.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/images/style.css" />
    <link rel="stylesheet" type="text/css" href="../../resources/css/myloading.css" />
	<style>
		td{text-align:center;}
		th{text-align:center !important;}
		td.optBtn {padding-left:10px;padding-right:0;text-align: left;}
		.optBtn button{margin-right:10px;}
		.search_inp{height: 22px; border: none;}
		.new-list{height:auto;text-align:center;font-size:15px;}
		.new-list>div{line-height:34px;}
		.new-list label {text-align: right;}
		.nopadding{padding:0}
		#batchSave:hover{background:#5CB85C;color:white;}
		#batchSReport:hover{background:#F0AD4E ;color:white;}
		#batchDel:hover{background: #D9534F;color:white;}
	</style>

</head>
<body>
<div class="loading">
		<div class="sk-circle">
		  <div class="sk-circle1 sk-child"></div>
		  <div class="sk-circle2 sk-child"></div>
		  <div class="sk-circle3 sk-child"></div>
		  <div class="sk-circle4 sk-child"></div>
		  <div class="sk-circle5 sk-child"></div>
		  <div class="sk-circle6 sk-child"></div>
		  <div class="sk-circle7 sk-child"></div>
		  <div class="sk-circle8 sk-child"></div>
		  <div class="sk-circle9 sk-child"></div>
		  <div class="sk-circle10 sk-child"></div>
		  <div class="sk-circle11 sk-child"></div>
		  <div class="sk-circle12 sk-child"></div>
		</div>
</div>
<div class="mr15" id="body_main">
	<div class="cl_title">
		<span class="_title">质控报告清单</span>
	</div>
	<div class="pa15">
		<div class="in-block" style="margin-left: 50px">
			<!-- 搜索框组件 -->
			<div class="search-group" >
				<div class="search-inp">
					<i class="ico-search fa fa-search"></i>
					<input type="text" id="seek" class="search_inp"  placeholder="请输入搜索关键字" name="content" />
					<i id="fa_times" class="refresh sea-refresh fa fa-times"></i>
				</div>
				<button type="submit" id="all_search" class="btn btn-search"> 搜索 </button>
			</div>
		</div>
		<div style="margin:20px 4% 10px 0;" class="fr">
			<div class="btn-group">
				<button type="button" class="btn btn-info">批量操作</button>
				<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					<span class="caret"></span>
					<span class="sr-only"></span>
				</button>
				<ul class="dropdown-menu">
					<li><a href="#" id="batchSave">另存</a></li>
					<li><a href="#" id="batchSReport">保存为报告</a></li>
					<li role="separator" class="divider" style="margin:0"></li>
					<li><a href="#" id="batchDel">删除</a></li>
				</ul>
			</div>
			<button  class="btn btn-green" id="addModel" style="margin-left: 50px;"><i class="fa fa-plus" ></i> 新建</button>

		</div>
		<div style="margin-left:50px" id="table">
			<table class="list1" style="width:96%;min-width:775px">
				<tr>
					<th style="width:35px;"><input type="checkbox" value="0" id="check_all"></th>
					<th style="width:42px;">序号</th>
					<th style="width:8%;">保存时间</th>
					<th style="width:15%;">报告类型</th>
					<th style="width:auto;">报告名称</th>
					<th style="width:14%;">目录样式</th>
					<th style="width:8%;">创建时间</th>
					<th style="width:7%;">创建人</th>
					<th style="width:282px;">操作</th>
				</tr>
				<tbody id="table1"></tbody>
			</table>
		</div>
	</div>
</div>
<!-- 新建模态框 -->
<div class="modal fade" id="modal_add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="true">
	<div class="modal-dialog" style="width:500px;margin:100px auto;" >
		<div class="modal-content">
			<div class="modal-header">
				<span >新建</span>
				<button type="button" class="close" data-dismiss="modal">
					<span class="is_true" aria-hidden="true">&times;</span>
					<span class="sr-only">Close</span>
				</button>
			</div>
			<div class="modal-body new-list">
				<div class="row">
					<label  class="col-xs-3"  id="reportType">报告类型 </label>
					<div class="col-xs-9 nopadding" style="text-align: left">
						<label style="font-weight: normal;margin-right:48px;">
							<input class="report_type" type="radio" value="0" name="report" checked="checked">
							<span>报告模版</span>
						</label>
						<label style="font-weight: normal">
							<input class="report_type" type="radio" value="1"  name="report" >
							<span >报告</span>
						</label>
					</div>
				</div>
				<div class="row">
					<label class="col-xs-3 control-label"  for="names">报告名称</label>
					<div class="col-xs-9 nopadding" style="width:344px">
						<input type="text" class="txt_inp" style="width:344px" name="names" id="names"/>
					</div>
				</div>
				<div class="row">
					<label class="col-xs-3 control-label" for="des">目录样式</label>
					<div class="pr col-xs-9 nopadding" style="width:344px">
						<input type="hidden" class="ajax_txt" id="catalogs" name="catalogs" value=""/>
						<input type="text" class="txt_inp" id="catalogs_down" title="请选择目录样式"  autocomplete="off" data-to="catalogs" data-type="json" data-src="_json_catalogs_down" value="--请选择--" onkeydown="return false;" style="width:344px;"/>
					</div>
				</div>
			</div>
			<div class="modal-footer" style="text-align: right">
				<button type="submit" class="btn btn-primary "id="is_add" >确定</button>
				<button type="button" class="btn btn-default " data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>
<!-- alert_Del共用模态框 -->
<div class="modal fade" id="modal_delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
	<div class="modal-dialog" style="width:300px;margin:65px auto;" >
		<div class="modal-content">
			<div class="modal-header" id="modal_title">
				<button type="button" class="close" data-dismiss="modal">
					<span class="is_true" aria-hidden="true">&times;</span>
					<span class="sr-only">Close</span>
				</button>

			</div>
			<div class="modal-body">
				<div style="height:65px;text-align: center;font-size: 18px" id="txt_insert">
					<span >确定删除吗?</span>
				</div>
			</div>
			<div class="modal-footer" style="text-align:right;">
				<button type="button" class="btn btn-primary " data-dismiss="modal" id="is_true">确定</button>
				<button type="button" class="btn btn-default is_false" data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>
<div id=AlertModal></div>
<script type="text/javascript" src="../../resources/js/tangram-min.js"></script>
<script type="text/javascript" src="../../resources/js/tangram-ext.js"></script>
<script type="text/javascript" src="../../resources/js/baiduTemplate.js"></script>
<script type="text/javascript" src="../../resources/jQuery/jquery.min.js"></script>
<script type="text/javascript" src="../../resources/js/bootstrap.js"></script>
<script type="text/javascript" src="../../resources/js/common.js"></script>

<script id="tpl11" type="text/template">
		[%	var j=1;
		for(var i in list){%]
		<tr>
			<td><input class="re-check" type="checkbox" value="[%=list[i].model_id%]" echo-type="[%=list[i].type%]" ></td>
			<td>[%=j%]</td>
			<td >[%=list[i].saveTime%]</td>
			<td >[%if(list[i].type=="0"){%][%='报告模版'%][%}else{%][%='报告'%][%}%]</td>
			<td >[%=list[i].name%]</td>
			<td>[%if(list[i].catStyle=="0"){%][%='目录1'%][%}else{%][%='目录2'%][%}%]</td>
			<td>[%=list[i].creatTime%]</td>
			<td>[%=list[i].creatPeople%]</td>
			<td class="optBtn">[%if(list[i].type=="0"){%]
				<button class="btn btn-primary edit"   data-echo="[%=list[i].model_id%]">编辑</button>
				<button class="btn btn-red delModel" >删除</button>
				<button class="btn btn-primary" >另存</button><!--<br>-->
				<button class="btn btn-primary" >保存为报告</button>
				[%}else{%]
				<button class="btn btn-primary browserRe"   data-echo="[%=list[i].report_id%]">浏览</button>
				<button class="btn btn-red delRe"  >删除</button>
				<button class="btn btn-primary exportRe" >导出</button>
				[%}%]
			</td>
		</tr>
		[%j++;}%]
</script>
<script>
	/* 设置主体内容最小高度 */
	var main_h=$('#mainframe', parent.document).height();
	var min_H=main_h-15;
	$("#body_main").css("min-height",min_H);
    var $name=$("#names"),
		$table1=$("#table1"),
        $des=$("#des"),
        $alertAdd=$("#modal_add"),
        $alertModal=$("#modal_delete"),
        $val=$("#val"),
    	$addBtn=$("#addModel");

    	/*加载质控报告清单*/
		var count=0,checkbox_leg=0;
		var all_data;
		$.ajax({
			url:"../../resources/ajax/tree3.json",
			success:function (data) {
                all_data=data;
			    $(".loading").hide();
				$("#table1").html(baidu.template("tpl11",data));
                checkbox_leg=$(".re-check").length;
                $(".re-check").click(function(){
                    var is_sure=$(this)[0].checked?1:-1;
                    count=count+is_sure;
                    if(count!=checkbox_leg){
                        $("#check_all")[0].checked="";
                    }else{
                        $("#check_all")[0].checked="checked";
                    }

                });
		}
		});


	var _json_catalogs_down=[];
	$.ajax({
		url:"../../resources/ajax/catlog.json",
		success:function (data) {
			_json_catalogs_down=data;
			T("#catalogs_down").dropdown({width:"344",height:"260"});
		}
	});
	/*添加*/
    $addBtn.click(function (event) {
        $name.val(null);
        $des.val(null);
        $val.val(null);
        $alertAdd.modal("toggle");
    });

	/* 搜索方法 */
    $("#all_search").click(function(){
        var seek=$("#seek").val();
        var search_res = {list:[]};
        if(seek != ""){
            $(".refresh").show();
            for(var i=0; i<all_data.list.length; i++){
                if(all_data.list[i].saveTime.indexOf(seek)>-1 || all_data.list[i].creatPeople.indexOf(seek)>-1 || all_data.list[i].name.indexOf(seek)>-1 || all_data.list[i].creatTime.indexOf(seek)>-1){
                    search_res.list.push(all_data.list[i]);
                }
            }
            if(search_res.list.length == 0){
                $("#AlertModal").children().remove();
                $("#AlertModal").append(AlertModal);
                $("#TxtInsert p").remove();
                $("#TxtInsert").append("<p>没有找到相关内容,请核对搜索关键词！</p>");
                $("#modal_alert").modal("toggle");
                _get('table1').innerHTML = baidu.template('tpl11', all_data);
            } else {
                _get('table1').innerHTML = baidu.template('tpl11', search_res);
            }
        } else {
            $("#AlertModal").children().remove();
            $("#AlertModal").append(AlertModal);
            $("#TxtInsert p").remove();
            $("#TxtInsert").append("<p>请输入要搜索的关键词</p>");
            $("#modal_alert").modal("toggle");

            _get('table1').innerHTML = baidu.template('tpl11', all_data);
        }
    });
	/* 还原叉叉 */
    $("#fa_times").click(function(){
        $("#seek").val("");
        _get('table1').innerHTML = baidu.template('tpl11', all_data);
        $("#fa_times").hide();
    });

    $("#check_all").click(function(){
        var checkbox= $(".re-check");
        if($(this)[0].checked){
            checkbox.prop("checked","checked");
            count=checkbox_leg;
        }else{
            checkbox.prop("checked","");
            count=0;
        }
    });


    $("#is_add").click(function () {
        var modelBtnArr='<td class="optBtn"> <button class="btn btn-primary "  >编辑</button><button class="btn btn-red delModel"  >删除</button> <button class="btn btn-primary"  >另存</button><button class="btn btn-primary"  >保存为报告</button> </td> ';
        var  reportBtnArr='<td class="optBtn"> <button class="btn btn-primary browserRe"  >浏览</button> <button class="btn btn-red delRe"  >删除</button> <button class="btn btn-primary exportRe" >导出</button> </td>';
//        var length=$table1.children().length+1,
		var length = parseInt($table1.children().last().children().first().html()) + 1;
			var docName= $name.val(),
			type=$("input:radio:checked").val(),
			time=new  Date(),
			vMon = time.getMonth() + 1,
			vDay = time.getDate(),
			saveTime= time.getFullYear() +"-"+ (vMon < 10 ? "0" + vMon : vMon) +"-"+ (vDay < 10 ? "0" + vDay : vDay),
			catalogueType=$("#catalogs_down").val(),
			creatTime=saveTime,
			creatPerson="王";
        var str='<tr> <td>'+length+'</td> <td>'+saveTime+'</td> <td >'+type+'</td> <td >'+docName+'</td> <td >'+catalogueType+'</td> <td >'+creatTime+'</td> <td>'+creatPerson+'</td>'+(type=="报告"?reportBtnArr:modelBtnArr)+'</tr>';
        $table1.append(str);
		$alertAdd.modal("hide");
    });
</script>
<script>
	/*报告操作*/
	$("#table1").on("click","button",function () {
        var id=this.getAttribute("data-echo");
	    switch (this.innerText){
			case "浏览":
			    window.parent.frames[0].location.href="report.html?edit="+id+"&report";
			    break;
            case "删除":
                var self=$(this);
                $alertModal.modal("toggle");
				$("#is_true").unbind();
                $("#is_true").click(function () {
                    self.parent().parent().remove();
                });
                break;
            case "导出":
                break;
            case "编辑":
                window.parent.frames[0].location.href="report.html?edit="+id;
                break;
            case "另存":
                break;
            case "保存为报告":
                break;

		}
    });
</script>
</body>
</html>
