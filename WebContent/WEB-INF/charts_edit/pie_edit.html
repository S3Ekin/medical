<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>图表创建编辑</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="../../resources/images/style.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/easyui.css"/>
	<script src="../../resources/echarts/echarts.js"></script>
	<style>
		#table1 tr th{padding: 8px 5px;text-align:center;}
		#table1 tr td{padding: 8px 5px;text-align:center;}
		.optBtn button{padding:0 8px;height:26px;margin-right:10px;}
		form{width:100%;}
		.bv-form .help-block{margin-bottom:0}
		.bv-form .tooltip-inner{text-align:left}
		.nav-tabs li.bv-tab-success>a{color:#3c763d}
		.nav-tabs li.bv-tab-error>a{color:#a94442}
		div.row { height:40px;line-height: 40px}
		div.topic { text-align: right; font-size: 16px; font-weight: 700; }
		.no-padding {padding:0;}
		.sourceBtn {padding:0 8px;height:26px;}
		div.content{padding:10px 5px;
			height:320px;overflow-y: scroll}
		div.footer button{padding: 5px 10px ;height: 30px;margin-right: 10px}
		div.footer{text-align: right;padding:5px 50px 5px 0;border-top: 2px solid #95B8E7;}
		.zb-name {color:#2081BB;white-space: nowrap;}
		.upload{display: none}
		.table{display: none}
		.zb{display: none}
		.pre{margin-left:16%;padding:20px; border: 1px solid #95B8E7;display: none;width:800px}
		#organization{height: 30px}
		 span.tree-title{font-size: 14px}
		.add-field{color:#2081BB;}
	</style>
</head>
<body>
<div class="mr15">
    <div style="width:100%;margin-top:5px;height:35px;z-index:9999;">
       	<span class="tab_title">图表创建编辑</span>
		<hr style="background-color:#DBDBDB;height:2px;border:none;margin-top:10px;">
    </div>
	<div class="container-fluid" style="width:90%;min-width:900px;padding: 20px 0 0 0" >
		<div class="row">
			<div  class="col-xs-2 topic">名称:</div>
			<div class="col-xs-9">
				<input type="text" class="clo-xs-9" id="name" value="饼图" style="width:100%;max-width: 400px ;height:30px">
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源类型:</div>
			<div class="col-xs-4">
				<input type="radio" name="dataType" value="1" checked="checked"><span>指标数据</span>
				<input type="radio" name="dataType" value="0"  style="margin-left: 20px"><span>上传数据</span>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源:</div>
			<div class="col-xs-1" >
				<button class="btn btn-primary sourceBtn">选择(单选)</button>
			</div>
		</div>
		<div class="zb">
			<div class="row">
				<div class="col-xs-2 topic" style="padding-left: 0">指标公共维度:</div>
				<div class="col-xs-1" style="width: 65px">频率:</div>
				<div class="col-xs-1 no-padding" >
					<div id="rotate"></div>
				</div>
				<div class="col-xs-1" style="width: 65px">日期:</div>
				<div class="col-xs-3 no-padding">
					<div>
						<div class="data-combo"></div>
					</div>
					<div style="display: none">
						<div class="calendar-combo" ></div>
					</div>
				</div>
				<div class="col-xs-1" style="width: 65px">机构:</div>
				<div class="col-xs-3 no-padding">
					<div id="organization"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic zb-name" ></div>
				<div class="col-xs-10" style="padding: 0">
					<div class="col-xs-3" style="width: 132px">选择占比的维度:</div>
					<div class="col-xs-3 no-padding">
						<div id="pie_wd" ></div>
					</div>
					<div class="col-xs-3" style="width: 90px;" >起始时间:</div>
					<div class="col-xs-3 no-padding">
						<div>
							<div class="data-combo"></div>
						</div>
						<div style="display: none">
							<div class="calendar-combo" ></div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<div class="upload">
			<div class="row">
				<div class="col-xs-2 topic">数据名称:</div>
				<div class="col-xs-10 zb-name"></div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">横轴字段:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">纵轴字段1:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
				<div class="col-xs-2" >
					<button type="button" class="btn btn-primary " id="field-btn">添加</button>
				</div>
			</div>
			<div class="add-col-field"></div>
		</div>
		<div class="table">
			<div class="row">
				<div class="col-xs-2 topic">图形标题:</div>
				<div class="col-xs-4">
					<input type="text" style="height: 30px;width: 100%" value="各科室10月的支出饼状图" id="title">
				</div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">图形参数:</div>
				<div class="col-xs-10 no-padding" >
					<div class="col-xs-3" style="width: 118px">是否为玫瑰图:</div>
					<div class="col-xs-2 no-padding">
						<input type="radio" name="roseType" value="1" ><span>是</span>
						<input type="radio" name="roseType" value="0"  style="margin-left: 20px" checked="checked"><span>否</span></div>
					<div class="col-xs-2" style="width: 78px">内半径:</div>
					<div class="col-xs-2 no-padding">
						<div class="radius"></div>
					</div>
					<div class="col-xs-2" style="width: 78px">外半径:</div>
					<div class="col-xs-2 no-padding">
						<div class="radius"></div>
					</div>
				</div>
			</div>
			<div class="row ">
				<div class="col-xs-2 topic">
					<button type="button" class="btn btn-primary " id="preChat">预览</button>
				</div>
			</div>
			<div>
				<div class="pre">
					<div id="chat" style="width:760px;height:350px;"></div>
				</div>
			</div>
		</div>

	</div>


</div>

<!-- 数据源 -->
<div id="sourceSelected" style="display: none">
	<div class="content" >
		<ul id="sourceTree">
		</ul>
	</div>
	<div class="footer">
		<button type="button" class="btn btn-primary "   id="select">确定</button>
				<button type="button" class="btn btn-primary" id="cancel">取消</button>
	</div>
</div>
<!-- alert共用模态框 -->
<div class="modal fade" id="modal_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
	<div class="modal-dialog" style="width:300px;margin:65px auto;" >
		<div class="modal-content">
			<div class="modal-header" id="modal_title">
				<button type="button" class="close" data-dismiss="modal">
					<span class="is_true" aria-hidden="true" style="position:relative;top:-8px;font-size:25px;">&times;</span><span class="sr-only">Close</span>
				</button>

			</div>
			<div class="modal-body">
				<div style="height:65px;text-align: center;font-size: 18px" id="txt_insert">
					<span >确定删除吗?</span>
				</div>
			</div>
			<div class="modal-footer" style="text-align:center;">
				<button type="button" class="btn btn-primary " data-dismiss="modal" id="is_true">确定</button>
				<button type="button" class="btn btn-primary is_false" data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../../resources/jQuery/jquery.min.js"></script>
<script type="text/javascript" src="../../resources/js/bootstrap.js"></script>
<script src="../../resources/jQuery/jquery.easyui.min.js"></script>
<script>
    var $radio = $("input[name=dataType]"),
        $sourceSlect=$(".sourceBtn span"),
        $zbName=$(".zb-name"),
        is_zb=true,
        $zb=$(".zb"),
        $dataCombo=$(".data-combo"),
        $calendar=$(".calendar-combo"),
        $org=$("#organization"),
        $upload=$(".upload"),
        $table=$(".table"),
        $sourceSelected=$("#sourceSelected"),
		$sourceBtn=$(".sourceBtn");
    /*机构树加载*/
    $org.combotree({
		url:"../ajax/org.json",
		method:"get",
        editable:true,
		width:180,
		height:30,
        panelWidth:180,
        panelHeight:300,
        value:"信息科"
	});
	/*占比维度加载*/
    $("#pie_wd").combobox({
        valueField:"id",
        textField:"text",
        url:"../ajax/row_wd.json",
        method:"get",
        editable:true,
        width:150,
        height:30,
        panelWidth:150,
        panelHeight:100,
        onLoadSuccess:function(data){
            var loadData=$(this).combobox("getData");
            $(this).combobox("setValue",loadData[3].text);
        },
        formatter:function (row) {
            return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
        }
    });
	/*字段框加载*/
    $(".field-combo").combobox({
        valueField:"id",
        textField:"text",
        url:"../ajax/row_wd.json",
        method:"get",
        editable:true,
        width:180,
        height:30,
        panelWidth:180,
        panelHeight:100,
        onLoadSuccess:function(data){
            var loadData=$(this).combobox("getData");
            $(this).combobox("setValue",loadData[3].text);
        },
        formatter:function (row) {
            return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
        }
    });
	/*添加纵轴字段*/
    var count=1;
    $("#field-btn").click(function () {
        count++;
        var str='<div class="row"><div class="col-xs-2 topic add-field">纵轴字段<span>'+count+'</span>:</div><div class="col-xs-4"><div class="new-field"></div></div><div class="col-xs-2" > <button type="button" class="btn btn-red field-del" >删除</button> </div></div>';
        $(".add-col-field").append(str);
        $(".new-field").combobox({
            valueField:"id",
            textField:"text",
            url:"../ajax/row_wd.json",
            method:"get",
            editable:true,
            width:180,
            height:30,
            panelWidth:180,
            panelHeight:100,
            onLoadSuccess:function(data){
                var loadData=$(this).combobox("getData");
                $(this).combobox("setValue",loadData[3].text);
            },
            formatter:function (row) {
                return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
            }
        });
    });
	/*删除纵轴字段*/
	var $addColField=$(".add-col-field");
    $addColField.on("click",".field-del",function () {
        var self=$(this);
        $("#modal_alert").modal("show");
        $("#is_true").click(function () {
            self.parent().parent().remove();
        });
    });
	/*删除纵轴字段按钮hover事件*/
    $addColField.on("mouseover",".field-del",function () {
        $(this).parent().siblings().eq(0).css("color","red");
    }).on("mouseout",".field-del",function () {
        $(this).parent().siblings().eq(0).css("color","#2081BB");
    });
	/*日期选择*/
	$.ajax({
		url:"../ajax/data.json",
		dataType:"json",
		success:function (data) {
            var dataArray=data;
			/*月期框加载*/
            $dataCombo.combobox({
                valueField:"id",
                textField:"text",
                data:dataArray.month,
                editable:true,
                width:80,
                height:30,
                panelWidth:80,
                panelHeight:100,
                formatter:function (row) {
                    return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
                }
            });
			/*频率框加载*/
            $("#rotate").combobox({
                valueField:"id",
                textField:"text",
                data:dataArray.rotate,
                editable:true,
                width:70,
                height:30,
                panelWidth:70,
                panelHeight:100,
                onLoadSuccess:function(){
                    var loadData=$(this).combobox("getData");
                    $(this).combobox("setValue",loadData[2].text);
                },
                formatter:function (row) {
                    return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
                },
				onSelect:function (recoder) {
                    var item=recoder.value;
                    if(recoder.id==4){
                        $dataCombo.parent().hide();
                        $calendar.parent().show();
                        $calendar.datebox({
                            width:180,
                            height:30,
                            panelWidth:180,
                            panelHeight:200,
							value:"Today"
                        });
					}else{
                        $calendar.parent().hide();
                        $dataCombo.parent().show();
                        $dataCombo.combobox("loadData",dataArray[item]);
                    }
                }
            });
        }
	});
	/*单选按钮事件*/
    $radio.on("click",function () {
        $zbName.html(null);
        $(".add-col-field").html(null);
        $table.hide();
        $(".pre").hide();
        $zb.hide();
        $upload.hide();
        is_zb=($(this).val()==1)?true:false;
    });
	/*数据源选择按钮*/
    $sourceBtn.on("click",function () {
        $sourceSelected.window("open");
    });
	/*数据源窗口加载*/
    $sourceSelected.window({
        title : '数据源选择',
        modal : true,
        shadow : true,
        closed : true,
        width : 300,
        height : 400,
        padding : 10,
        minimizable : false,
        maximizable : false,
        collapsible : false,
        top : ($(window).height() - 500) * 0.5,
        left : ($(window).width() - 400) * 0.5,
        resizeable:false,
        onOpen : function(){
		// 加载窗口树
            $('#sourceTree').tree({
                url : is_zb?"../ajax/SelectKpi.json":"../ajax/upload.json",
                method:"get",
                animate:true,
                checkbox:false
            })
        }
    });
	/*添加资源*/
	var show_combo;
	$.ajax({
        url:"../ajax/show_type.json",
		success:function (data) {
            show_combo=data;
        }
	});
    $(".footer").on("click","button",function(){
        switch ($(this).html()){
			case "确定":
                var htm ="";
				var nodes=$("#sourceTree").tree("getSelected");
				    if(!nodes||nodes.children.length){
				        alert("请选择文件!");
				        return ;
					}else{
				        if(is_zb){
                            $zb.show();
                            $upload.hide();
						}else{
                            $zb.hide();
                            $upload.show();
						}
                        htm="<span >"+nodes.text+"</span>";
                        $zbName.html(htm);
					}
				$table.show();
			    break;
			default:
			    break;
		}
        $sourceSelected.window("close");
    });


</script>
<script>
	/*chats加载*/
    $("#preChat").click(function () {
        if(is_zb){
        }else{
        }
        var title=$("#title").val();
        var roseType=$("input[name='roseType']:checked").val();
        roseType=roseType==1?true:false;
        $(".pre").show();
        var pieoption = {
            title : {
                text: title,
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: ['院办公室','信息科','财务科','总务科','医务科']
            },
            series : [
                {
                    name: '科室',
                    type: 'pie',
                    center: ['50%', '60%'],
                    data:[
                        {value:335, name:'院办公室'},
                        {value:310, name:'信息科'},
                        {value:234, name:'财务科'},
                        {value:135, name:'总务科'},
                        {value:1548, name:'医务科'}
                    ],
                    roseType:roseType,
                    radius:['30%','75%'],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        var myChart = echarts.init($('#chat')[0]);
        myChart.setOption(pieoption);
    })
</script>
<div class="clr"></div>
</body>
</html>
