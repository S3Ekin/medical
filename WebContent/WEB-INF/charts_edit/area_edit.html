<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>图表创建编辑</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="../../resources/images/style.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/easyui.css"/>
	<link rel="stylesheet" href="chat_edit.css">
</head>
<body>
<div class="mr15">
    <div style="width:100%;margin-top:5px;height:35px;z-index:9999;">
       	<span class="tab_title">图表创建编辑</span>
		<hr style="background-color:#DBDBDB;height:2px;border:none;margin-top:10px;">
    </div>
	<div class="container-fluid" style="width:90%;min-width:900px;padding: 20px 0 0 0" >
		<div class="row">
			<div  class="col-xs-2 topic">名称:</div>
			<div class="col-xs-9">
				<input type="text" class="clo-xs-9" id="name" value="折线图" style="width:100%;max-width: 400px ;height:30px">
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源类型:</div>
			<div class="col-xs-4">
				<input type="radio" name="dataType" value="1" checked="checked"><span>指标数据</span>
				<input type="radio" name="dataType" value="0"  style="margin-left: 20px"><span>上传数据</span>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源:</div>
			<div class="col-xs-1" >
				<button class="btn btn-primary sourceBtn">选择(<span>多选</span>)</button>
			</div>
		</div>
		<div class="zb">
			<div class="row">
				<div class="col-xs-2 topic" style="padding-left: 0">指标公共维度:</div>
				<div class="col-xs-7 combo-data" >
					<span class="combo-title">频率:</span>
					<div id="rotate"></div>
					<div class="data-combo-year"></div>
					<div> <div class="data-combo"></div>
					</div>
					<span style="color:darkgreen">———</span>
					<div class="data-combo-year"></div>
					<div> <div class="data-combo"></div>
					</div>
				</div>
				<div class="col-xs-3 no-padding">
					<span class="combo-title">科室:</span><div id="organization"></div>
				</div>
			</div>
			<div class="newAdd"></div>
			<div class="row">
				<div class="col-xs-2 topic">横轴维度:</div>
				<div class="col-xs-3 ">
					<div class="wd-combo"></div>
				 </div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">纵轴维度:</div>
				<div class="col-xs-4">
					<div class="wd-combo"></div>
				</div>
			</div>
		</div>
		<div class="upload">
			<div class="row">
				<div class="col-xs-2 topic">数据名称:</div>
				<div class="col-xs-10 zb-name"></div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">横轴字段:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">纵轴字段1:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
				<div class="col-xs-2" >
					<button type="button" class="btn btn-primary " id="field-btn">添加</button>
				</div>
			</div>
			<div class="add-col-field"></div>
		</div>
		<div class="table">
			<div class="row">
				<div class="col-xs-2 topic">图形标题:</div>
				<div class="col-xs-6">
					<input type="text" style="height: 30px;width: 100%"  id="title">
				</div>
			</div>
			<div class="row ">
				<div class="col-xs-2 topic">
					<button type="button" class="btn btn-primary " id="preChat">预览</button>
				</div>
			</div>
			<div class="pre">
				<div id="chat" style="width:760px;height:600px"></div>
			</div>
		</div>
	</div>
</div>

<!-- 数据源 -->
<div id="sourceSelected" style="display: none">
	<div class="content" >
		<ul id="sourceTree"></ul>
	</div>
	<div class="footer">
		<button type="button" class="btn btn-primary "   id="select">确定</button>
				<button type="button" class="btn btn-primary" id="cancel">取消</button>
	</div>
</div>
<!-- alert共用模态框 -->
<div class="modal fade" id="modal_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
	<div class="modal-dialog" style="width:300px;margin:65px auto;" >
		<div class="modal-content">
			<div class="modal-header" id="modal_title">
				<button type="button" class="close" data-dismiss="modal">
					<span class="is_true" aria-hidden="true" style="position:relative;top:-8px;font-size:25px;">&times;</span><span class="sr-only">Close</span>
				</button>

			</div>
			<div class="modal-body">
				<div style="height:65px;text-align: center;font-size: 18px" id="txt_insert">
					<span >确定删除吗?</span>
				</div>
			</div>
			<div class="modal-footer" style="text-align:center;">
				<button type="button" class="btn btn-primary " data-dismiss="modal" id="is_true">确定</button>
				<button type="button" class="btn btn-primary is_false" data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../../resources/jQuery/jquery.min.js"></script>
<script type="text/javascript" src="../../resources/js/bootstrap.js"></script>
<script src="../../resources/echarts/echarts.js"></script>
<script src="../../resources/jQuery/jquery.easyui.min.js"></script>
<script src="chat_edit.js"></script>
<script>
	/*chats加载*/

	$("#preChat").click(function () {
		switch (is_zb) {
			case true:
				var comboData = $(" .zb .textbox-text");
				var Arr=[];
				for (var  i= 0;  i< comboData.length; i++) {
					var obj = comboData[i];
					Arr.push(obj.value)
				}
				/*时间 指标*/
				var time=Arr.slice(1,5),
					zbArr=Arr.slice(6,(Arr.length-2));
				for (var i = 0; i <time.length; i++) {
					time[i] =parseInt(time[i]);
				}
				var zbName=$(".zb .zb-name");
				var legenData=[];
				for (var i = 0,count=0; i < zbName.length; i++,count+=2) {
					zbArr[count]=zbArr[count]+zbName[i].innerHTML.replace(/(住院重点疾病|住院重点手术)*/g,"");
					legenData.push(zbArr[count]);
				}
				console.log(Arr,zbArr,time);
				var _title ,_count;
				var _year = time[0], _month = time[1] - 1, _season = time[1] - 1;
				var XData=[];
				switch (Arr[0]) {
					case "年份":
						_title=Arr[5]+Arr[1]+"—"+Arr[3]+"各医疗质量指标";
						_count = time[2] - time[0];
						_year=_year-1;
						for (var i = 0; i < _count + 1; i++) {
							_year = _year + 1;
							XData.push(_year);
						}
						break;
					case "季度":
						_title=Arr[5]+Arr[1]+Arr[2]+"—"+Arr[3]+Arr[4]+"各医疗质量指标";
						_count = time[3] + (time[2] - time[0] - 1) * 4 + 4 - time[1];
						for (var i = 0; i < _count + 1; i++) {
							if ((1 + _season) % 5 == 0) {
								_season = 1;
								_year++;
							} else {
								_season = (1 + _season) % 5;
							}
							XData.push(_year+"年"+_season+"季度");
						}
						break;
					default:
						_title=Arr[5]+Arr[1]+Arr[2]+"—"+Arr[3]+Arr[4]+"各医疗质量指标";
						_count = time[3] + (time[2] - time[0] - 1) * 12 + 12 - time[1];
						for (var i = 0; i < _count + 1; i++) {
							if ((1 + _month) % 13 == 0) {
								_month = 1;
								_year++;
							} else {
								_month = (1 + _month) % 13;
							}
							XData.push(_year+"年"+_month+"月");
						}
						break;
				}
				var seriesData=[];
				for (var i = 0,count=1; i < legenData.length; i++,count+=2) {
					seriesData[i]={};
					seriesData[i].name=legenData[i];
					seriesData[i].type=zbArr[count]=="柱状"?'bar':"line";
					seriesData[i].areaStyle={};
					seriesData[i].areaStyle=zbArr[count]=="面积"?{normal: {}}:null;
					seriesData[i].data=[];
					for (var j = 0; j < XData.length; j++) {
						seriesData[i].data.push(parseInt(Math.random()*90+1))
					}
				}
				if(!$("#title").val()){
					$("#title").val(_title);
				}
					var pieoption = {
			title: {
				text: $("#title").val(),
				x: 'center',
			},
			tooltip: {
				trigger: 'axis',
				axisPointer : {            // 坐标轴指示器，坐标轴触发有效
					type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
				}
			},
			grid:{
				containLabel:true,
				height:400,
			},
			legend: {
//				orient: 'vertical',
				bottom:'bottom',
				data:legenData,
			},
			toolbox: {
				top:25,
				show: true,
				feature: {
					dataZoom: {
						yAxisIndex: false
					},
					dataView: {readOnly: false},
					//显示模式 line折线，bar柱状，stack堆叠，tiled平铺
					magicType: {type: ['line', 'bar','stack','tiled']},
					restore: {},
					saveAsImage: {}
				}
			},
			xAxis: {
				type: 'category',
				boundaryGap: true,
				data: XData
			},
			yAxis: [{
				position:"left",
				name:"例",
				type: 'value',
				axisLabel: {
					formatter: '{value}'
				}
			},{
				position:"right",
				max:100,
				min:0,
				type: 'value',
				axisLabel: {
					formatter: '{value}%'
				}
			}],
			series:seriesData,
			dataZoom: [{
				start: 10,
				end: 100,
				bottom:"80"
			}, {
				type: 'inside'
			}],
		};
				break;
			default:
                var tabId=$("#sourceTree").tree("getSelected").id;
				if(tabId==12){
					$("#title").val("一季度各科室检查数")
					 var pieoption= {
           title: {
               text: $("#title").val(),
               x:'10%'
           },
           tooltip: {
               trigger: 'axis',
               formatter: "{b}: {c} 次"
           },
           toolbox: {
               feature: {
                   dataView: {
                       show: true,
                       readOnly: false
                   },
                   restore: {
                       show: true
                   },
                   saveAsImage: {
                       show: true
                   }
               }
           },
           grid: {
               containLabel: true
           },
           legend: {
               data: ['一月','二月','三月']
           },
           xAxis: [{
               type: 'category',
               name:"科室",
               nameGap:50,
               axisTick: {
                   alignWithLabel: true
               },
               data:['C T室','放 射 科','B 超 室','输 血 科']
           }],
           yAxis: [
              /* {
               type: 'category',
               name: '阳性率',
               min: 0,
               max: 100,
               position: 'right',
               axisLabel: {
                   formatter: '{value} %'
               }
           }, */
			   {
               type: 'value',
               name: '检查数',
               position: 'left'
           }],
           series: [
           /*    {
               name: '阳性率',
               type: 'line',
               lineStyle: {
                   normal: {
                       width: 3,
                       shadowColor: 'rgba(0,0,0,0.4)',
                       shadowBlur: 10,
                       shadowOffsetY: 10
                   }
               },
               data: [
                   // 每一列称为一个『维度』。
                   // 这里分别是维度 0、1、2、3、4。
                   [12, 44, 55, 66],
                   [23, 6, 16, 23],
                   [23, 6, 16, 23]
           ]
           },*/
           /*{
               type:"bar",
			   dimensions:	['C T室', '放 射 科', 'B 超 室','输 血 科'],
			   data:[
					   1190,1226,1693,78
           ]}*/
			   {
                   name: '一月',
                   type: 'bar',
//                   yAxisIndex: 1,
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
                              },
                   data: [1190,1426,1793,115]
               },{
                   name: '二月',
                   type: 'bar',
//                   yAxisIndex:1,
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
						  },
                   data: [1190,1226,1693,125]
               },{
                   name: '三月',
                   type: 'bar',
//                   yAxisIndex: 1,
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
						 },
                   data: [1390,1126,1593,135]
               }

           ]
       };
				}else{
					$("#title").val("各科终末病历总评价")

    			var pieoption= {
           title: {
               text: $("#title").val(),
               x:'10%'
           },
           tooltip: {
               trigger: 'axis',
			   formatter: "{b} <br/>{a0} : {c0} 次<br/>{a1} : {c1} 次<br/>{a2} : {c2} 次"
           },
           toolbox: {
               feature: {
                   dataView: {
                       show: true,
                       readOnly: false
                   },
                   restore: {
                       show: true
                   },
                   saveAsImage: {
                       show: true
                   }
               }
           },
           grid: {
               containLabel: true
           },
           legend: {
               data: ['甲级','乙级','丙级']
           },
           xAxis: [{
               type: 'category',
               name:"科室",
               nameGap:50,
               axisTick: {
                   alignWithLabel: true
               },
               data:['泌尿科','心内科','呼吸科','外三科']
           }],
           yAxis: [
			   {
               type: 'value',
               name: '检查数',
               position: 'left'
           }],
           series: [
			   {
                   name: '甲级',
                   type: 'bar',
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
                              },
                   data: [9,8,8,8]
               },
			   {

                   name: '乙级',
                   type: 'bar',
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
						  },
                   data: [1,0,1,1]
               },{
                   name: '丙级',
                   type: 'bar',
                   label: {
                              normal: {
                              show: true,
                              position: 'top'
                              }
						 },
                   data: [0,2,1,1]
               }

           ]
       };
		}
				break;
		};
		$(".pre").show();

		var myChart = echarts.init($('#chat')[0]);
		myChart.setOption(pieoption);
	})


    /*$("#preChat").click(function () {
        if(is_zb){
        }else{
        }
        var title=$("#title").val();
        $(".pre").show();
        var myChart = echarts.init($('#chat').get(0));
        var pieoption = {
            //标题
            title: {
                //主标题
                text: title,
                //副标题
                subtext: '数据来自GWN'
            },
            //提示框
            tooltip: {
                //折线图提示框
                trigger: 'axis'
            },
            //图例
            legend: {
//                top:'bottom',
				right:"right",
                //数据
                data:['预算管理指标','预算执行率','预算收入执行率']
            },
            //工具箱
            toolbox: {
                //是否显示
                show: true,
                //工具箱配置
                feature: {
                    //数据区域缩放 直角坐标系支持
                    dataZoom: {
                        //缩放时控制的Y轴，为空则不控制所有Y轴，为false则控制Y轴
                        yAxisIndex: false
                    },
                    //是否数据不可编辑，false表示可编辑
                    dataView: {readOnly: false},
                    //显示模式 line折线，bar柱状，stack堆叠，tiled平铺
                    magicType: {type: ['line', 'bar']},
                    //还原
                    restore: {},
                    //下载为图片
                    saveAsImage: {}
                }
            },
            //横坐标
            xAxis:  {
                type: 'category',
                boundaryGap: false,
                data:['201601','201602','201603','201604','201605','201606','201607','201608'],
//			//坐标轴类型，value数据，category类型，time时间，
//			type: 'category',
//			//起点和重点数据是否定格，是否留白
//			boundaryGap: false,
//			//数据
//			data: ['周一','周二','周三','周四','周五','周六','周日','周一','周二','周三','周四','周五','周六','周日']
            },
            //纵坐标
            yAxis: {

                type: 'value',
                axisLabel: {
                    formatter: '{value} 万'
                }


//			type: 'value',
//			//纵坐标显示标签
//			axisLabel: {
//				formatter: '{value} °C'
//			}
            },
            series:[
                    //准备添加的数据
                    {
                        name:'预算管理指标',
                        //折线图
                        type:'line',
                        //数据
                        data:[53,67,74,88,91,106,119,127],
                    },
                    {
                        name:'预算执行率',
                        //折线图
                        type:'line',
                        //数据
                        data:[41,56,79,83,105,114,131,149],
                    },
                    {
                        name:'预算收入执行率',
                        //折线图
                        type:'line',
                        //数据
                        data:[81,82,93,94,105,106,117,118],
                    }
                    //最高气温表
//			{
//				name:'最高气温',
//				//折线图
//				type:'line',
//				//数据
//				data:[11, 11, 15, 13, 12, 13, 10, 11, 11, 14, 13, 12, 13, 11],
//				//图表标注
//				markPoint: {
//					data: [
//						//最大最小值
//						{type: 'max', name: '最大值'},
//						{type: 'min', name: '最小值'}
//					]
//				},
//				//图表标线
//				markLine: {
//					data: [
//						//平均值
//						{type: 'average', name: '平均值'}
//					]
//				}
//			},
                //最低气温表
//			{
//				name:'最低气温',
//				type:'line',
//				data:[1, -2, 2, 5, 3, 2, 0, 1, -1, 2, 4, 3, 2, 0],
//				markPoint: {
//					data: [
//						{name: '周最低', value: -2, xAxis: 1, yAxis: -2},
//						{name: '周最高', value: 5, xAxis: 3, yAxis: 5}
//					]
//				},
//				markLine: {
//					data: [
//						{type: 'average', name: '平均值'},
//						//自定义样式
//						[
//						//起始点
//						{
//							//起始点样式
//							symbol: 'circle',
//							//起始点x坐标位置
//							x: '90%',
//							//起始点Y坐标位置
//							yAxis: 'max'
//						},
//						//终点
//						{
//							//终点样式
//							symbol: 'circle',
//							//标签样式
//							label: {
//								normal: {
//									//标签出现位置
//									position: 'start',
//									//标签格式
//									formatter: '最大值'
//								}
//							},
//							type: 'max',
//							name: '最高点'
//						}]
//					]
//				}
//			}
            ],
			dataZoom: [{
				start: 10,
				end: 100
			}, {
				type: 'inside'
			}],
		};
        myChart.setOption(pieoption);
    })*/
</script>
<div class="clr"></div>
</body>
</html>
