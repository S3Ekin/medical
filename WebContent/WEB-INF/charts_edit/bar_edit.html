<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>表格创建编辑</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="../../resources/images/style.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../../resources/css/easyui.css"/>
	<link rel="stylesheet" href="chat_edit.css">
	
</head>
<body>
<div class="mr15">
    <div style="width:100%;margin-top:5px;height:35px;z-index:9999;">
       	<span class="tab_title">表格创建编辑</span>
		<hr style="background-color:#DBDBDB;height:2px;border:none;margin-top:10px;">
    </div>
	<div class="container-fluid" style="width:90%;min-width:900px;padding: 20px 0 0 0" >
		<div class="row">
			<div  class="col-xs-2 topic">名称:</div>
			<div class="col-xs-9">
				<input type="text" class="clo-xs-9" id="name" value="柱状图" style="width:100%;max-width: 400px ;height:30px">
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源类型:</div>
			<div class="col-xs-4">
				<input type="radio" name="dataType" value="1" checked="checked"><span>指标数据</span>
				<input type="radio" name="dataType" value="0"  style="margin-left: 20px"><span>上传数据</span>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2 topic">数据源:</div>
			<div class="col-xs-1" >
				<button class="btn btn-primary sourceBtn">选择(<span>多选</span>)</button>
			</div>
		</div>
		<div class="zb">
			<div class="row">
				<div class="col-xs-2 topic" style="padding-left: 0">指标公共维度:</div>
				<div class="col-xs-1" style="width:65px">频率:</div>
				<div class="col-xs-1 no-padding">
					<div id="rotate"></div>
				</div>
				<div class="col-xs-1 " style="width:85px">时间段:</div>
				<div class="col-xs-3 no-padding">
					<div>
						<div class="data-combo"></div>
					</div>
					<div style="display: none">
						<div class="calendar-combo" ></div>
					</div>
				</div>
				<div class="col-xs-1 " style="width:65px">机构:</div>
				<div class="col-xs-3 no-padding">
					<div id="organization"></div>
				</div>
			</div>
			<div class="newAdd"></div>
			<div class="row">
				<div class="col-xs-2 topic">横轴维度:</div>
				<div class="col-xs-3 ">
					<div class="wd-combo"></div>
				 </div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">纵轴维度:</div>
				<div class="col-xs-4">
					<div class="wd-combo"></div>
				</div>
			</div>
		</div>
		<div class="upload">
			<div class="row">
				<div class="col-xs-2 topic">数据名称:</div>
				<div class="col-xs-10 zb-name"></div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">横轴字段:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-2 topic">纵轴字段1:</div>
				<div class="col-xs-4">
					<div class="field-combo"></div>
				</div>
				<div class="col-xs-2" >
					<button type="button" class="btn btn-primary " id="field-btn">添加</button>
				</div>
			</div>
			<div class="add-col-field"></div>
		</div>
		<div class="table">
			<div class="row">
				<div class="col-xs-2 topic">图形标题:</div>
				<div class="col-xs-4">
					<input type="text" style="height: 30px;width: 100%" value="2016年护理部各指标" id="title">
				</div>
			</div>
			<div class="row ">
				<div class="col-xs-2 topic">
					<button type="button" class="btn btn-primary " id="preChat">预览</button>
				</div>
				<div class="col-xs-10 pre">
					<div id="chat" style="width:100%;height:350px"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 数据源 -->
<div id="sourceSelected">
	<div class="content" >
		<ul id="sourceTree">
		</ul>
	</div>
	<div class="footer">
		<button type="button" class="btn btn-primary "   id="select">确定</button>
				<button type="button" class="btn btn-primary" id="cancel">取消</button>
	</div>
</div>
<!-- alert共用模态框 -->
<div class="modal fade" id="modal_alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
	<div class="modal-dialog" style="width:300px;margin:65px auto;" >
		<div class="modal-content">
			<div class="modal-header" id="modal_title">
				<button type="button" class="close" data-dismiss="modal">
					<span class="is_true" aria-hidden="true" style="position:relative;top:-8px;font-size:25px;">&times;</span><span class="sr-only">Close</span>
				</button>

			</div>
			<div class="modal-body">
				<div style="height:65px;text-align: center;font-size: 18px" id="txt_insert">
					<span >确定删除吗?</span>
				</div>
			</div>
			<div class="modal-footer" style="text-align:center;">
				<button type="button" class="btn btn-primary " data-dismiss="modal" id="is_true">确定</button>
				<button type="button" class="btn btn-primary is_false" data-dismiss="modal">取消</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../../resources/jQuery/jquery.min.js"></script>
<script type="text/javascript" src="../../resources/js/bootstrap.js"></script>
<script src="../../resources/echarts/echarts.js"></script>
<script src="../../resources/jQuery/jquery.easyui.min.js"></script>
<!--<script>
    var $radio = $("input[name=dataType]"),
        $sourceSlect=$(".sourceBtn span"),
        $zbName=$(".zb-name"),
        is_zb=true,
        $zb=$(".zb"),
        $newAdd=$(".newAdd"),
        $org=$("#organization"),
        $dataCombo=$(".data-combo"),
        $calendar=$(".calendar-combo"),
        $upload=$(".upload"),
        $table=$(".table"),
        $sourceSelected=$("#sourceSelected"),
		$sourceBtn=$(".sourceBtn");
    /*日期下拉框加载*/
	/*日期选择*/
    $.ajax({
        url:"../ajax/data.json",
        dataType:"json",
        success:function (data) {
            var dataArray=data;
			/*月期框加载*/
            $dataCombo.combobox({
                valueField:"id",
                textField:"text",
                data:dataArray.month,
                editable:true,
                width:80,
                height:30,
                panelWidth:80,
                panelHeight:100,
                formatter:function (row) {
                    return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
                }
            });
			/*频率框加载*/
            $("#rotate").combobox({
                valueField:"id",
                textField:"text",
                data:dataArray.rotate,
                editable:true,
                width:70,
                height:30,
                panelWidth:70,
                panelHeight:100,
                onLoadSuccess:function(){
                    var loadData=$(this).combobox("getData");
                    $(this).combobox("setValue",loadData[2].text);
                },
                formatter:function (row) {
                    return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
                },
                onSelect:function (recoder) {
                    var item=recoder.value;
                    if(recoder.id==4){
                        $dataCombo.parent().hide();
                        $calendar.parent().show();
                        $calendar.datebox({
                            width:180,
                            height:30,
                            panelWidth:180,
                            panelHeight:200,
                            value:"Today"
                        });
                    }else{
                        $calendar.parent().hide();
                        $dataCombo.parent().show();
                        $dataCombo.combobox("loadData",dataArray[item]);
                    }
                }
            });
        }
    });
    /*机构树加载*/
    $org.combotree({
		url:"../ajax/org.json",
		method:"get",
        editable:true,
		width:180,
		height:30,
        panelWidth:180,
        panelHeight:300,
        value:"信息科"
	});
	/*维度框加载*/
    $(".wd-combo").combobox({
		valueField:"id",
		textField:"text",
        url:"../ajax/row_wd.json",
        method:"get",
        editable:true,
        width:180,
        height:30,
        panelWidth:180,
        panelHeight:100,
        onLoadSuccess:function(data){
			var loadData=$(this).combobox("getData");
			$(this).combobox("setValue",loadData[3].text);
		},
		formatter:function (row) {
            return "<span class='glyphicon glyphicon-pushpin'>&nbsp;"+row.text+"</span>"
        }
    });
	/*字段框加载*/
    $(".field-combo").combobox({
        valueField:"id",
        textField:"text",
        url:"../ajax/row_wd.json",
        method:"get",
        editable:true,
        width:180,
        height:30,
        panelWidth:180,
        panelHeight:100,
        onLoadSuccess:function(data){
            var loadData=$(this).combobox("getData");
            $(this).combobox("setValue",loadData[3].text);
        },
        formatter:function (row) {
            return "<span class='glyphicon glyphicon-check'>&nbsp;"+row.text+"</span>"
        }
    });
	/*单选按钮事件*/
    $radio.on("click",function () {
        $zbName.html(null);
        $table.hide();
        $(".pre").hide();
        $zb.hide();
        $upload.hide();
		if($(this).val()==1){
            $sourceSlect.html("多选");
            is_zb=true;
		}else{
            $sourceSlect.html("单选");
            is_zb=false;
		}
    });
	/*数据源选择按钮*/
    $sourceBtn.on("click",function () {
        $sourceSelected.window("open");
    });
	/*数据源窗口加载*/
    $sourceSelected.window({
        title : '数据源选择',
        modal : true,
        shadow : true,
        closed : true,
        width : 300,
        height : 400,
        padding : 10,
        minimizable : false,
        maximizable : false,
        collapsible : false,
        top : ($(window).height() - 500) * 0.5,
        left : ($(window).width() - 400) * 0.5,
        onOpen : function(){
            var urls,is_checked;
            if(is_zb){
                 urls="../ajax/SelectKpi.json";
					is_checked=true;
			}else{
                 urls="../ajax/upload.json";
                is_checked=false;
			}
		// 加载窗口树文件
            $('#sourceTree').tree({
                url:urls,
                method:"get",
                animate:true,
                checkbox:is_checked
            });
        }
    });
	/*添加资源*/
	var show_combo;
	$.ajax({
        url:"../ajax/show_type.json",
		success:function (data) {
            show_combo=data;
        }
	});
    $(".footer").on("click","button",function(){
        switch ($(this).html()){
			case "确定":
                var htm ="",
                	str ="",
					state = is_zb ? "getChecked":"getSelected";
                $newAdd.html(null);
				var nodes=$("#sourceTree").tree(state);
				if(is_zb){
				    if(nodes.length){
                for (var i = 0,length=nodes.length; i <length; i++) {
                    var obj = nodes[i];
					if (obj.children.length!=0){
					    continue;
					}else{
                        var _showId=(obj.id<5)?0:((obj.id<13)?1:2);
                        str ='<div class="row"><div class = "col-xs-2 zb-name topic" >'+obj.text+":"+'</div><div class = "col-xs-10 no-padding" ><div class="col-xs-2" style="width: 65px;">'+show_combo[_showId].type+':'+'</div><div class ="col-xs-9 no-padding" ><div id="show_type_'+i+'"></div></div></div >';
                        $newAdd.append(str);
                        $("#show_type_"+i).combobox({
                            valueField:"id",
                            textField:"text",
                            data:show_combo[_showId].combo,
                            editable:true,
                            width:180,
                            height:30,
                            panelWidth:180,
                            panelHeight:100,
                            onLoadSuccess:function(){
                                var loadData=$(this).combobox("getData");
                                $(this).combobox("setValue",loadData[1].text);
                            },
                            formatter:function (row) {
                                return "<span class='glyphicon glyphicon-check'>&nbsp;" + row.text + "</span>"
                            }
                        });
                    }
                }

				$zb.show();
				$upload.hide();
                    }else{
                        alert("没有选择文件！");
                        return ;
                    }
                }else{
				    if(!nodes||nodes.children.length){
				        alert("请选择文件！");
				        return ;
					}else{
				        $zb.hide();
				        $upload.show();
                        htm="<span >"+nodes.text+"</span>";
                        $zbName.html(htm);
					}
				}
				$table.show();
			    break;
			default:
			    break;
		}
        $sourceSelected.window("close");
    });


</script>-->
<script src="chat_edit.js"></script>
<script >
	/*chats加载*/
    $("#preChat").click(function () {
        if(is_zb){
        }else{
        }
        var title=$("#title").val();
        $(".pre").show();
        var myChart = echarts.init($('#chat').get(0));
        var pieoption =  {
            //标题
            title: {
                //主标题
                text: title,
                //副标题
                subtext: '数据来自GWN'
            },
            //提示框
            tooltip: {
                //折线图提示框
                trigger: 'axis'
            },
            //图例
            legend: {
                top:'bottom',
                //数据
                data:['预算管理指标','预算执行率','预算收入执行率']
            },
            //工具箱
            toolbox: {
                //是否显示
                show: true,
                //工具箱配置
                feature: {
                    //数据区域缩放 直角坐标系支持
                    dataZoom: {
                        //缩放时控制的Y轴，为空则不控制所有Y轴，为false则控制Y轴
                        yAxisIndex: false
                    },
                    //是否数据不可编辑，false表示可编辑
                    dataView: {readOnly: false},
                    //显示模式 line折线，bar柱状，stack堆叠，tiled平铺
                    magicType: {type: ['line', 'bar']},
                    //还原
                    restore: {},
                    //下载为图片
                    saveAsImage: {}
                }
            },
            //横坐标
            xAxis:  {
                type: 'category',
                boundaryGap: true,
                data:['201601','201602','201603','201604','201605','201606','201607','201608'],
//			//坐标轴类型，value数据，category类型，time时间，
//			type: 'category',
//			//起点和重点数据是否定格，是否留白
//			boundaryGap: true,
//			//数据
//			data: ['周一','周二','周三','周四','周五','周六','周日','周一','周二','周三','周四','周五','周六','周日']
            },
            //纵坐标
            yAxis: {

                type: 'value',
                axisLabel: {
                    formatter: '{value} 万'
                }


//			type: 'value',
//			//纵坐标显示标签
//			axisLabel: {
//				formatter: '{value} °C'
//			}
            },
            series:
                [
                    //准备添加的数据
                    {
                        name:'预算管理指标',
                        //折线图
                        type:'bar',
                        //数据
                        data:[53,67,74,88,91,106,119,127],
                    },
                    {
                        name:'预算执行率',
                        //折线图
                        type:'bar',
                        //数据
                        data:[41,56,79,83,105,114,131,149],
                    },
                    {
                        name:'预算收入执行率',
                        //折线图
                        type:'bar',
                        //数据
                        data:[81,82,93,94,105,106,117,118],
                    }
                    //最高气温表
//			{
//				name:'最高气温',
//				//折线图
//				type:'line',
//				//数据
//				data:[11, 11, 15, 13, 12, 13, 10, 11, 11, 14, 13, 12, 13, 11],
//				//图表标注
//				markPoint: {
//					data: [
//						//最大最小值
//						{type: 'max', name: '最大值'},
//						{type: 'min', name: '最小值'}
//					]
//				},
//				//图表标线
//				markLine: {
//					data: [
//						//平均值
//						{type: 'average', name: '平均值'}
//					]
//				}
//			},
                //最低气温表
//			{
//				name:'最低气温',
//				type:'line',
//				data:[1, -2, 2, 5, 3, 2, 0, 1, -1, 2, 4, 3, 2, 0],
//				markPoint: {
//					data: [
//						{name: '周最低', value: -2, xAxis: 1, yAxis: -2},
//						{name: '周最高', value: 5, xAxis: 3, yAxis: 5}
//					]
//				},
//				markLine: {
//					data: [
//						{type: 'average', name: '平均值'},
//						//自定义样式
//						[
//						//起始点
//						{
//							//起始点样式
//							symbol: 'circle',
//							//起始点x坐标位置
//							x: '90%',
//							//起始点Y坐标位置
//							yAxis: 'max'
//						},
//						//终点
//						{
//							//终点样式
//							symbol: 'circle',
//							//标签样式
//							label: {
//								normal: {
//									//标签出现位置
//									position: 'start',
//									//标签格式
//									formatter: '最大值'
//								}
//							},
//							type: 'max',
//							name: '最高点'
//						}]
//					]
//				}
//			}
            ]
        };
        myChart.setOption(pieoption);
    })
</script>
<div class="clr"></div>
</body>
</html>
